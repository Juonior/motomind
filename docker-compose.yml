services:
  mercedes-obd-bot:
    build: .
    container_name: mercedes-obd-bot
    restart: unless-stopped
    env_file:
      - .env
    privileged: true  # Необходимо для доступа к Bluetooth устройствам
    devices:
      - /dev/ttyUSB0:/dev/ttyUSB0  # Для USB OBD адаптеров
      - /dev/rfcomm0:/dev/rfcomm0  # Для Bluetooth OBD адаптеров
    volumes:
      - /dev:/dev  # Доступ к устройствам
    network_mode: host  # Для работы с Bluetooth может потребоваться host network
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - OBD_PORT=${OBD_PORT:-}
      - OBD_MAC=${OBD_MAC:-}
      - OBD_PROTOCOL=${OBD_PROTOCOL:-}
      - ADMIN_IDS=${ADMIN_IDS:-}
      - OPENAI_BASE_URL=${OPENAI_BASE_URL:-https://api.deepseek.com}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-deepseek-chat}
      - REDIS_URL=${REDIS_URL:-redis://127.0.0.1:6379/0}
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    container_name: motomind-redis
    restart: unless-stopped
    command: ["redis-server", "--save", "60", "1", "--appendonly", "yes"]
    network_mode: host
    volumes:
      - redis-data:/data

volumes:
  redis-data:

